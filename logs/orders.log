2025-06-03 00:04:00,064 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:04:16,141 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:04:43,511 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:05:05,505 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:05:57,575 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:05:57,606 - ERROR - orders - Unexpected error in create_order endpoint: module 'app.crud.crud_order' has no attribute 'get_create_order_function'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 144, in place_order
    create_order_fn = crud_order.get_create_order_function(current_user.user_type)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'app.crud.crud_order' has no attribute 'get_create_order_function'
2025-06-03 00:06:40,876 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:06:56,996 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:07:10,440 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:08:01,285 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:08:10,130 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:08:24,203 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:08:24,203 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 00:08:24,203 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 00:08:24,203 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 00:08:24,204 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('10000.00000000'), 'margin': Decimal('0E-8')}
2025-06-03 00:08:24,204 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 00:08:24,210 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 00:08:24,210 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 00:08:24,211 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 00:08:24,211 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:08:24,211 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:08:24,211 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 00:08:24,222 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 00:08:24,222 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 00:08:24,222 - DEBUG - orders - Standard margin calculation for AUDCAD: 8.9000000000000000
2025-06-03 00:08:24,222 - DEBUG - orders - Converting margin from CAD to USD. Amount: 8.9000000000000000
2025-06-03 00:08:24,222 - ERROR - orders - Unexpected error during margin calculation for user 1, symbol AUDCAD, order_type BUY: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\margin_calculator.py", line 251, in calculate_single_order_margin
    adjusted_prices = await get_adjusted_market_price_cache(redis_client, user_group_name, direct_conversion_symbol)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 00:08:24,225 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 00:08:24,225 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 00:08:24,227 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 00:09:42,830 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:09:56,452 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:10:01,262 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:10:19,411 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:10:40,461 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:10:55,444 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:10:55,445 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 00:10:55,445 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 00:10:55,445 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 00:10:55,448 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('10000.00000000'), 'margin': Decimal('0E-8')}
2025-06-03 00:10:55,448 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 00:10:55,460 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 00:10:55,461 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 00:10:55,462 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 00:10:55,462 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:10:55,463 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:10:55,463 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 00:10:55,485 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 00:10:55,485 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 00:10:55,485 - DEBUG - orders - Standard margin calculation for AUDCAD: 8.9000000000000000
2025-06-03 00:10:55,486 - DEBUG - orders - Converting margin from CAD to USD. Amount: 8.9000000000000000
2025-06-03 00:10:55,486 - DEBUG - orders - Attempting direct conversion using symbol: CADUSD
2025-06-03 00:10:55,486 - ERROR - orders - Unexpected error during margin calculation for user 1, symbol AUDCAD, order_type BUY: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\margin_calculator.py", line 252, in calculate_single_order_margin
    adjusted_prices = await get_adjusted_market_price_cache(redis_client, user_group_name, direct_conversion_symbol)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 00:10:55,497 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 00:10:55,498 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 00:10:55,500 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 00:12:44,360 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:13:06,912 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:13:13,210 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:13:13,211 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 00:13:13,211 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 00:13:13,211 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 00:13:13,213 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('10000.00000000'), 'margin': Decimal('0E-8')}
2025-06-03 00:13:13,213 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 00:13:13,223 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 00:13:13,224 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 00:13:13,225 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 00:13:13,225 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:13:13,225 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:13:13,226 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 00:13:13,244 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 00:13:13,245 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 00:13:13,245 - DEBUG - orders - Standard margin calculation for AUDCAD: 8.9000000000000000
2025-06-03 00:13:13,245 - DEBUG - orders - Converting margin from CAD to USD. Amount: 8.9000000000000000
2025-06-03 00:13:13,245 - DEBUG - orders - Attempting direct conversion using symbol: CADUSD
2025-06-03 00:13:13,247 - DEBUG - orders - No direct conversion rate found for CADUSD
2025-06-03 00:13:13,247 - DEBUG - orders - Attempting indirect conversion using symbol: USDCAD
2025-06-03 00:13:13,249 - DEBUG - orders - No indirect conversion rate found for USDCAD
2025-06-03 00:13:13,249 - DEBUG - orders - Calling _convert_to_usd with: amount=8.9000000000000000, from_currency=CAD, user_id=1, position_id=margin_calc_for_AUDCAD_BUY
2025-06-03 00:13:13,249 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd CALLED for 'Order Margin'. Amount: 8.9000000000000000, FromCurrency: CAD.
2025-06-03 00:13:13,250 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting direct with CADUSD. Rate: None
2025-06-03 00:13:13,252 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting indirect with USDCAD. Rate: None
2025-06-03 00:13:13,252 - WARNING - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - FAILED to find valid adjusted conversion rate from CAD to USD for Order Margin. Order Margin will remain 8.9000000000000000 CAD.
2025-06-03 00:13:13,252 - DEBUG - orders - Conversion result: 8.9000000000000000 CAD -> 8.90 USD
2025-06-03 00:13:13,253 - ERROR - orders - Failed to convert margin from CAD to USD for user 1, symbol AUDCAD. Original amount: 8.9000000000000000, Converted amount: 8.90
2025-06-03 00:13:13,253 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 00:13:13,253 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 00:13:13,256 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 00:15:29,954 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:29,954 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:29,954 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:32,170 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:32,171 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:32,171 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:34,360 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:34,360 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:34,360 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:36,689 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:36,689 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:36,689 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:38,995 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:38,995 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:38,995 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:41,303 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:41,303 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:41,303 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:43,508 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:43,508 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:43,509 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:45,847 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:45,847 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:45,847 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:48,117 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:48,117 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:48,117 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:50,444 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:50,444 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:50,445 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:52,762 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:52,763 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:52,763 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:55,113 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:55,113 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:55,113 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:57,270 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:57,270 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:57,270 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:15:59,539 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:15:59,539 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:15:59,539 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:01,868 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:01,868 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:01,868 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:04,117 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:04,117 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:04,117 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:06,514 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:06,514 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:06,514 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:08,808 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:08,808 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:08,808 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:11,148 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:11,148 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:11,148 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:13,391 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:13,391 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:13,391 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:15,643 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:15,643 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:15,644 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:17,932 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:17,932 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:17,932 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:20,236 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:20,236 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:20,236 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:22,632 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:22,632 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:22,632 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:24,862 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:24,862 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:24,862 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:27,237 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:27,237 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:27,237 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:29,482 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:29,482 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:29,482 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:31,727 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:31,727 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:31,727 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:34,090 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:34,090 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:34,090 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:36,449 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:36,449 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:36,449 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:38,620 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:38,620 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:38,620 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:40,930 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:40,930 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:40,930 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:43,192 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:43,192 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:43,192 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:45,516 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:45,516 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:45,516 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:47,801 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:47,801 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:47,801 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:50,105 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:50,105 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:50,105 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:52,522 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:52,522 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:52,523 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:54,700 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:54,700 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:54,700 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:57,026 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:57,026 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:57,026 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:16:59,414 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:16:59,414 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:16:59,415 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:01,622 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:01,622 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:01,622 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:03,978 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:03,978 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:03,978 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:06,246 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:06,246 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:06,246 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:08,507 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:08,507 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:08,507 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:10,858 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:10,858 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:10,858 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:13,190 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:13,190 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:13,190 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:15,416 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:15,416 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:15,416 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:17,718 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:17,718 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:17,718 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:19,993 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:19,993 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:19,993 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:22,341 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:22,342 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:22,342 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:24,623 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:24,623 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:24,623 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:26,893 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:17:26,893 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:17:26,893 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:17:31,021 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:18:05,858 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:05,858 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:05,858 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:05,971 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:05,971 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:05,971 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:08,334 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:08,335 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:08,335 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:10,669 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:10,669 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:10,669 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:12,379 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:18:12,379 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 00:18:12,379 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 00:18:12,379 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 00:18:12,380 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('0E-8')}
2025-06-03 00:18:12,380 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 00:18:12,388 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 00:18:12,388 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 00:18:12,389 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 00:18:12,389 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:18:12,389 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:18:12,389 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 00:18:12,403 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 00:18:12,405 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 00:18:12,406 - DEBUG - orders - Standard margin calculation for AUDCAD: 8.9000000000000000
2025-06-03 00:18:12,406 - DEBUG - orders - Converting margin from CAD to USD. Amount: 8.9000000000000000
2025-06-03 00:18:12,406 - DEBUG - orders - Attempting direct conversion using symbol: CADUSD
2025-06-03 00:18:12,407 - DEBUG - orders - No direct conversion rate found for CADUSD
2025-06-03 00:18:12,407 - DEBUG - orders - Attempting indirect conversion using symbol: USDCAD
2025-06-03 00:18:12,408 - DEBUG - orders - No indirect conversion rate found for USDCAD
2025-06-03 00:18:12,408 - DEBUG - orders - Calling _convert_to_usd with: amount=8.9000000000000000, from_currency=CAD, user_id=1, position_id=margin_calc_for_AUDCAD_BUY
2025-06-03 00:18:12,409 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd CALLED for 'Order Margin'. Amount: 8.9000000000000000, FromCurrency: CAD.
2025-06-03 00:18:12,409 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting direct with CADUSD. Rate: None
2025-06-03 00:18:12,410 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting indirect with USDCAD. Rate: None
2025-06-03 00:18:12,410 - WARNING - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - FAILED to find valid adjusted conversion rate from CAD to USD for Order Margin. Order Margin will remain 8.9000000000000000 CAD.
2025-06-03 00:18:12,410 - DEBUG - orders - Conversion result: 8.9000000000000000 CAD -> 8.90 USD
2025-06-03 00:18:12,410 - ERROR - orders - Failed to convert margin from CAD to USD for user 1, symbol AUDCAD. Original amount: 8.9000000000000000, Converted amount: 8.90
2025-06-03 00:18:12,411 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 00:18:12,411 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 00:18:12,415 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 00:18:12,963 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:12,963 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:12,963 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:15,290 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:15,290 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:15,290 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:17,569 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:17,569 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:17,569 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:19,765 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:19,765 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:19,765 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:22,021 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:22,021 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:22,021 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:24,426 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:24,426 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:24,427 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:26,657 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:26,657 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:26,657 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:28,928 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:28,928 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:28,928 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:31,240 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:31,240 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:31,240 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:33,527 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:33,527 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:33,528 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:35,848 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:35,848 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:35,848 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:38,130 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:38,130 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:38,130 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:40,475 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:40,475 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:40,475 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:42,821 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:42,822 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:42,822 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:45,088 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:45,088 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:45,088 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:47,324 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:47,324 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:47,324 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:49,630 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:49,630 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:49,630 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:51,987 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:51,987 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:51,988 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:54,417 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:54,417 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:54,417 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:56,702 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:56,702 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:56,702 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:18:58,985 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:18:58,985 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:18:58,985 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:19:01,295 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:19:01,295 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:19:01,295 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:19:03,576 - DEBUG - orders - User 1: Calculating portfolio for 0 open positions.
2025-06-03 00:19:03,576 - WARNING - orders - User 1: Overall hedged margin is zero or negative (0E-8), margin_level cannot be calculated. Setting to 0.0 or a suitable default.
2025-06-03 00:19:03,576 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 0E-8, Free Margin: 100000.00000000, Margin Level: 0.0
2025-06-03 00:19:07,928 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:19:24,572 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:19:24,572 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 00:19:24,572 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 00:19:24,572 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 00:19:24,573 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('0E-8')}
2025-06-03 00:19:24,573 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 00:19:24,579 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 00:19:24,579 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 00:19:24,579 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 00:19:24,579 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:19:24,580 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:19:24,580 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 00:19:24,592 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 00:19:24,592 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 00:19:24,592 - DEBUG - orders - Standard margin calculation for AUDCAD: 8.9000000000000000
2025-06-03 00:19:24,593 - DEBUG - orders - Converting margin from CAD to USD. Amount: 8.9000000000000000
2025-06-03 00:19:24,593 - DEBUG - orders - Attempting direct conversion using symbol: CADUSD
2025-06-03 00:19:24,593 - DEBUG - orders - No direct conversion rate found for CADUSD
2025-06-03 00:19:24,593 - DEBUG - orders - Attempting indirect conversion using symbol: USDCAD
2025-06-03 00:19:24,594 - DEBUG - orders - No indirect conversion rate found for USDCAD
2025-06-03 00:19:24,594 - DEBUG - orders - Calling _convert_to_usd with: amount=8.9000000000000000, from_currency=CAD, user_id=1, position_id=margin_calc_for_AUDCAD_BUY
2025-06-03 00:19:24,594 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd CALLED for 'Order Margin'. Amount: 8.9000000000000000, FromCurrency: CAD.
2025-06-03 00:19:24,594 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting direct with CADUSD. Rate: None
2025-06-03 00:19:24,594 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting indirect with USDCAD. Rate: None
2025-06-03 00:19:24,594 - WARNING - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - FAILED to find valid adjusted conversion rate from CAD to USD for Order Margin. Order Margin will remain 8.9000000000000000 CAD.
2025-06-03 00:19:24,594 - DEBUG - orders - Conversion result: 8.9000000000000000 CAD -> 8.90 USD
2025-06-03 00:19:24,594 - ERROR - orders - Failed to convert margin from CAD to USD for user 1, symbol AUDCAD. Original amount: 8.9000000000000000, Converted amount: 8.90
2025-06-03 00:19:24,595 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 00:19:24,595 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 00:19:24,596 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 00:22:41,982 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:23:48,299 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:23:48,299 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 00:23:48,300 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 00:23:48,300 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 00:23:48,303 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('0E-8')}
2025-06-03 00:23:48,303 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 00:23:48,319 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 00:23:48,319 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 00:23:48,321 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 00:23:48,321 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:23:48,321 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:23:48,321 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 00:23:48,361 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 00:23:48,361 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 00:23:48,362 - DEBUG - orders - Standard margin calculation for AUDCAD: 8.9000000000000000
2025-06-03 00:23:48,362 - DEBUG - orders - Converting margin from CAD to USD. Amount: 8.9000000000000000
2025-06-03 00:23:48,362 - DEBUG - orders - Attempting direct conversion using symbol: CADUSD
2025-06-03 00:23:48,365 - DEBUG - orders - No direct conversion rate found for CADUSD
2025-06-03 00:23:48,366 - DEBUG - orders - Attempting indirect conversion using symbol: USDCAD
2025-06-03 00:23:48,368 - DEBUG - orders - No indirect conversion rate found for USDCAD
2025-06-03 00:23:48,368 - DEBUG - orders - Calling _convert_to_usd with: amount=8.9000000000000000, from_currency=CAD, user_id=1, position_id=margin_calc_for_AUDCAD_BUY
2025-06-03 00:23:48,368 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd CALLED for 'Order Margin'. Amount: 8.9000000000000000, FromCurrency: CAD.
2025-06-03 00:23:48,370 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting direct with CADUSD. Rate: None
2025-06-03 00:23:48,371 - DEBUG - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - Attempting indirect with USDCAD. Rate: None
2025-06-03 00:23:48,371 - WARNING - orders - User 1, Pos margin_calc_for_AUDCAD_BUY: ADJUSTED _convert_to_usd - FAILED to find valid adjusted conversion rate from CAD to USD for Order Margin. Order Margin will remain 8.9000000000000000 CAD.
2025-06-03 00:23:48,371 - DEBUG - orders - Conversion result: 8.9000000000000000 CAD -> 8.90 USD
2025-06-03 00:23:48,371 - ERROR - orders - Failed to convert margin from CAD to USD for user 1, symbol AUDCAD. Original amount: 8.9000000000000000, Converted amount: 8.90
2025-06-03 00:23:48,371 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 00:23:48,371 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 00:23:48,373 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 00:25:39,541 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:26:39,876 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 00:26:39,876 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 00:26:39,876 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 00:26:39,876 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 00:26:39,877 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('0E-8')}
2025-06-03 00:26:39,877 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 00:26:39,882 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 00:26:39,882 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 00:26:39,883 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 00:26:39,883 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:26:39,883 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 00:26:39,883 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 00:26:39,895 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 00:26:39,895 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 00:26:39,895 - DEBUG - orders - Standard margin calculation for AUDCAD: 8.9000000000000000
2025-06-03 00:26:39,895 - WARNING - orders - TEMPORARILY SKIPPING CURRENCY CONVERSION FROM CAD TO USD. Using original amount: 8.9000000000000000
2025-06-03 00:26:39,895 - INFO - orders - Margin calculated for user 1, symbol AUDCAD, order_type BUY: Margin_USD=8.90, PriceBasisForMargin=0.89, AdjustedExecPrice/LimitPrice=0.89000, Contract_Units=1000.00000000, SymbolType=1
2025-06-03 00:26:39,951 - INFO - orders - Successfully created order for user 1: 2274538506
2025-06-03 00:26:51,747 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:26:51,747 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:26:51,748 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:26:53,773 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:26:53,773 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:26:53,781 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:26:56,114 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:26:56,149 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:26:56,154 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:26:58,353 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:26:58,353 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:26:58,358 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:00,695 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:00,695 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:00,698 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:02,922 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:02,922 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:02,925 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:05,324 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:05,325 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:05,330 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:07,655 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:07,655 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:07,661 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:09,917 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:09,917 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:09,923 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:12,209 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:12,209 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:12,216 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:14,585 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:14,585 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:14,591 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:16,799 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:16,799 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:16,803 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:19,070 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:19,071 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:19,075 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:21,357 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:21,357 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:21,360 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:23,587 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:23,587 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:23,589 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:25,918 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:25,918 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:25,920 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:28,266 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:28,267 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:28,268 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:30,578 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:30,578 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:30,580 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:33,004 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:33,004 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:33,011 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:35,219 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:35,219 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:35,222 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:37,482 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:37,483 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:37,486 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:39,730 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:39,731 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:39,733 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:41,978 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:41,979 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:41,980 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:44,305 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:44,305 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:44,307 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:46,605 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:46,605 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:46,607 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:48,993 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:48,993 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:48,995 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:51,214 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:51,214 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:51,217 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:53,500 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:53,500 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:53,502 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:55,862 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:55,862 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:55,864 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:27:58,105 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:27:58,105 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:27:58,106 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:00,363 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:00,363 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:00,364 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:02,718 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:02,718 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:02,720 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:04,968 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:04,969 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:04,970 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:07,317 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:07,317 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:07,319 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:09,571 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:09,571 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:09,573 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:11,915 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:11,915 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:11,918 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:14,305 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:14,305 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:14,307 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:16,475 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:16,476 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:16,478 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:18,896 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:18,896 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:18,898 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:21,078 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:21,078 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:21,080 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:23,392 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:23,392 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:23,395 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:25,743 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:25,743 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:25,745 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:28,133 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:28,133 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:28,136 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:30,371 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:30,371 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:30,373 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:32,587 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:32,587 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:32,589 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:34,955 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:34,956 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:34,957 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:37,213 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:37,213 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:37,214 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:39,480 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:39,480 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:39,482 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:41,845 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:41,845 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:41,847 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:44,134 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:44,134 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:44,136 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:46,428 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:46,428 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:46,430 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:48,791 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:48,791 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:48,793 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:51,049 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:51,049 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:51,052 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:53,427 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:53,427 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:53,429 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:55,629 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:55,629 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:55,631 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:28:57,931 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:28:57,931 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:28:57,933 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:00,241 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:00,241 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:00,243 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:02,541 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:02,541 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:02,544 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:04,830 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:04,830 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:04,832 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:07,130 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:07,130 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:07,132 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:09,470 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:09,470 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:09,472 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:11,706 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:11,706 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:11,708 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:14,089 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:14,089 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:14,091 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:16,321 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:16,321 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:16,323 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:18,593 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:18,593 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:18,597 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:20,890 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:20,890 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:20,892 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:23,314 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:23,314 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:23,316 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:25,558 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:25,558 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:25,560 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:27,806 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:27,806 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:27,808 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:30,153 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:30,153 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:30,155 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:32,413 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:32,413 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:32,415 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:34,783 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:34,783 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:34,785 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:37,022 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:37,022 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:37,024 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:39,294 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:39,294 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:39,296 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:41,619 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:41,619 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:41,622 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:43,916 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:43,916 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:43,918 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:46,246 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:46,246 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:46,249 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:48,537 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:48,537 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:48,539 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:50,845 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:50,845 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:50,848 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:53,153 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:53,153 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:53,155 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:55,436 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:55,436 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:55,438 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:29:57,741 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:29:57,741 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:29:57,746 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:00,716 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:00,717 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:00,719 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:02,390 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:02,390 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:02,392 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:04,735 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:04,735 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:04,737 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:07,024 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:07,024 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:07,026 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:09,330 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:09,331 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:09,333 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:11,638 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:11,638 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:11,639 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:13,922 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:13,922 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:13,924 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:16,216 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:16,216 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:16,219 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:18,526 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:18,527 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'live_price': None}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:18,529 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:22,817 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:30:52,907 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:52,907 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:30:52,907 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:52,974 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:52,974 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:52,979 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:55,368 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:55,369 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:55,372 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:30:57,667 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:30:57,667 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:30:57,672 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:00,008 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:00,009 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:00,015 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:02,249 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:02,249 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:02,253 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:04,641 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:04,642 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:04,647 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:06,854 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:06,854 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:06,858 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:09,242 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:09,242 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:09,248 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:11,449 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:11,449 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:11,452 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:13,996 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:13,996 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:14,002 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:16,135 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:16,135 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:16,138 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:18,419 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:18,419 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:18,425 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:20,681 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:20,681 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:20,685 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:22,914 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:22,914 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:22,917 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:25,258 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:25,258 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:25,260 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:27,491 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:27,491 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:27,493 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:29,918 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:29,918 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:29,920 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:32,102 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:32,102 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:32,104 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:34,454 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:34,454 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:34,456 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:36,704 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:36,704 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:36,706 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:39,069 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:39,069 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:39,072 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:41,312 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:41,312 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:41,314 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:43,690 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:43,690 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:43,691 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:45,933 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:45,933 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:45,935 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:48,221 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:48,221 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:48,222 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:50,527 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:50,527 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:50,529 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:52,912 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:52,912 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:52,914 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:55,176 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:55,176 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:55,178 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:57,430 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:57,430 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:57,432 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:31:59,708 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:31:59,708 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:31:59,710 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:02,130 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:02,130 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:02,131 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:04,342 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:04,342 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:04,344 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:06,643 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:06,643 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:06,646 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:08,913 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:08,913 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:08,915 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:11,401 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:11,401 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:11,402 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:13,612 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:13,612 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:13,614 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:15,950 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:15,950 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:15,952 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:18,302 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:18,302 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:18,304 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:20,560 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:20,560 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:20,562 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:22,801 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:22,801 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:22,802 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:25,145 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:25,145 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:25,147 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:27,354 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:27,354 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:27,356 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:29,762 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:29,762 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:29,764 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:31,992 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:31,992 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:31,994 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:34,306 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:34,306 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:34,308 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:36,634 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:36,634 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:36,636 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:38,976 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:38,976 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:38,977 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:41,187 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:41,187 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:41,189 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:43,497 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:43,497 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:43,499 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:45,749 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:45,749 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:45,752 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:48,078 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:48,078 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:48,080 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:50,404 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:50,404 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:50,406 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:52,688 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:52,688 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:52,690 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:55,035 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:55,036 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:55,037 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:57,323 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:57,323 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:57,326 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:32:59,627 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:32:59,628 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:32:59,632 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:33:01,876 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:33:01,876 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:33:01,878 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:33:04,208 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:33:04,208 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:33:04,210 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:33:06,541 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:33:06,541 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:33:06,544 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:33:08,828 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:33:08,828 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:33:08,832 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:33:11,128 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:33:11,128 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 157, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Adjusted PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:33:11,131 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:33:17,830 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:34:41,898 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:41,898 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:34:41,898 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:43,281 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:43,281 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:34:43,281 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:43,286 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:45,716 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:45,716 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:34:45,716 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:45,720 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:47,893 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:47,893 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:34:47,894 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:47,899 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:50,179 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:50,179 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:34:50,179 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:50,184 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:52,533 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:52,533 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:34:52,533 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:52,537 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:54,839 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:54,840 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.40000000000000000000000000
2025-06-03 00:34:54,840 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:54,844 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:57,070 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:57,071 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8865900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.41000000000000000000000000
2025-06-03 00:34:57,071 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:57,076 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:34:59,514 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:34:59,515 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.39000000000000000000000000
2025-06-03 00:34:59,515 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:34:59,519 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:01,649 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:01,649 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.40000000000000000000000000
2025-06-03 00:35:01,649 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:01,653 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:04,049 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:04,049 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:35:04,049 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:04,054 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:06,240 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:06,240 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:35:06,241 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:06,245 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:08,494 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:08,494 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.40000000000000000000000000
2025-06-03 00:35:08,495 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:08,496 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:10,802 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:10,802 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8865900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.41000000000000000000000000
2025-06-03 00:35:10,802 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:10,805 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:13,111 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:13,111 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:13,111 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:13,113 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:15,567 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:15,567 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:15,567 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:15,569 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:17,699 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:17,699 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:17,699 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:17,701 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:20,063 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:20,063 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:35:20,063 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:20,065 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:22,314 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:22,314 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.39000000000000000000000000
2025-06-03 00:35:22,314 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:22,316 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:24,601 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:24,601 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:24,601 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:24,604 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:26,893 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:26,893 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:26,893 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:26,895 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:29,210 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:29,210 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:35:29,210 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:29,212 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:31,525 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:31,525 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:31,526 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:31,528 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:33,809 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:33,809 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:33,809 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:33,811 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:36,131 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:36,131 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:36,131 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:36,133 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:38,398 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:38,399 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:38,399 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:38,401 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:40,687 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:40,688 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8865800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.42000000000000000000000000
2025-06-03 00:35:40,688 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:40,690 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:43,004 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:43,004 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:43,004 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:43,006 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:45,299 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:45,299 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:45,299 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:45,301 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:47,583 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:47,583 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:47,583 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:47,586 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:49,899 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:49,899 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.40000000000000000000000000
2025-06-03 00:35:49,900 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:49,902 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:52,197 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:52,197 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.36000000000000000000000000
2025-06-03 00:35:52,197 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:52,201 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:54,484 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:54,484 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8865800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.42000000000000000000000000
2025-06-03 00:35:54,484 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:54,486 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:56,767 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:56,767 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:56,767 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:56,768 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:35:59,083 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:35:59,083 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.38000000000000000000000000
2025-06-03 00:35:59,083 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:35:59,086 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:36:05,441 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:38:08,138 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:38:10,534 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:10,534 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:38:10,534 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:12,684 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:12,684 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:38:12,684 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:14,995 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:14,995 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:38:14,995 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:15,001 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:17,293 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:17,293 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:38:17,294 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:17,296 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:19,661 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:19,661 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88659 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.410000000000000000000000
2025-06-03 00:38:19,661 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:19,666 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:21,957 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:21,957 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88658 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.420000000000000000000000
2025-06-03 00:38:21,957 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:21,962 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:24,236 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:24,237 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:38:24,237 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:24,241 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:26,563 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:26,563 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88661 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.390000000000000000000000
2025-06-03 00:38:26,563 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:26,569 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:28,885 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:28,885 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:38:28,885 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:31,192 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:31,192 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88659 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.410000000000000000000000
2025-06-03 00:38:31,192 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:31,195 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:33,438 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:33,438 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:38:33,438 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:33,440 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:35,708 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:35,708 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.400000000000000000000000
2025-06-03 00:38:35,708 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:35,710 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:38,020 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:38,020 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.400000000000000000000000
2025-06-03 00:38:38,020 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:38,024 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:40,313 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:40,313 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88666 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.340000000000000000000000
2025-06-03 00:38:40,313 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:40,317 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:42,679 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:42,679 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88661 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.390000000000000000000000
2025-06-03 00:38:42,679 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:42,681 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:45,060 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:45,060 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:38:45,060 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:45,065 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:47,251 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:47,252 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:38:47,252 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:47,257 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:49,580 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:49,580 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:38:49,580 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:49,585 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:51,935 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:51,936 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:38:51,936 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:51,941 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:54,146 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:54,146 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:38:54,146 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:54,150 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:56,492 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:56,492 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88663 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.370000000000000000000000
2025-06-03 00:38:56,492 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:56,497 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:38:58,775 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:38:58,776 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:38:58,776 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:38:58,781 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:01,045 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:01,045 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:39:01,045 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:01,050 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:03,350 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:03,351 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:39:03,351 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:03,352 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:05,632 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:05,632 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88655 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.450000000000000000000000
2025-06-03 00:39:05,632 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:05,638 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:07,911 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:07,911 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88658 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.420000000000000000000000
2025-06-03 00:39:07,911 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:07,913 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:10,225 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:10,225 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88657 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.430000000000000000000000
2025-06-03 00:39:10,225 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:10,228 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:12,587 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:12,587 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88658 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.420000000000000000000000
2025-06-03 00:39:12,587 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:12,589 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:14,926 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:14,926 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88655 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.450000000000000000000000
2025-06-03 00:39:14,926 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:14,928 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:17,157 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:17,157 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88654 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.460000000000000000000000
2025-06-03 00:39:17,157 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:17,160 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:19,457 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:19,457 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88658 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.420000000000000000000000
2025-06-03 00:39:19,457 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:19,459 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:21,779 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:21,779 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:39:21,779 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:24,079 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:24,079 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88663 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.370000000000000000000000
2025-06-03 00:39:24,080 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:24,084 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:26,372 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:26,372 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88664 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.360000000000000000000000
2025-06-03 00:39:26,372 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:26,375 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:28,682 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:28,682 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88664 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.360000000000000000000000
2025-06-03 00:39:28,682 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:28,687 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:31,109 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:31,109 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:39:31,109 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:31,111 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:33,350 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:33,350 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88666 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.340000000000000000000000
2025-06-03 00:39:33,350 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:33,353 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:35,581 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:35,581 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88661 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.390000000000000000000000
2025-06-03 00:39:35,581 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:35,583 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:37,872 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:37,872 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88663 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.370000000000000000000000
2025-06-03 00:39:37,872 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:37,874 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:40,209 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:40,209 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:39:40,209 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:42,466 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:42,466 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:39:42,466 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:42,469 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:44,804 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:44,804 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:39:44,804 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:47,094 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:47,094 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:39:47,094 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:49,408 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:49,408 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88664 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.360000000000000000000000
2025-06-03 00:39:49,408 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:49,411 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:51,698 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:51,699 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88665 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.350000000000000000000000
2025-06-03 00:39:51,699 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:51,702 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:53,986 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:53,986 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:39:53,986 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:53,989 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:56,323 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:56,323 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88662 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.380000000000000000000000
2025-06-03 00:39:56,323 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:56,325 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:39:58,605 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:39:58,606 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88663 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.370000000000000000000000
2025-06-03 00:39:58,606 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:39:58,608 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:00,906 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:00,906 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88658 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.420000000000000000000000
2025-06-03 00:40:00,906 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:00,908 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:03,200 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:03,200 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88654 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.460000000000000000000000
2025-06-03 00:40:03,201 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:03,204 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:05,484 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:05,484 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88668 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.320000000000000000000000
2025-06-03 00:40:05,484 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:05,488 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:07,779 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:07,779 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88654 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.460000000000000000000000
2025-06-03 00:40:07,779 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:07,781 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:10,066 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:10,066 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.88664 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.360000000000000000000000
2025-06-03 00:40:10,066 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:10,070 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:12,412 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:12,412 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.300000000000000000000000
2025-06-03 00:40:12,412 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:12,414 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:14,684 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:14,684 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:40:14,684 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:18,953 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:40:41,424 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:41,424 - WARNING - orders - User 1, Pos 2274538506: PnL Market data or group settings missing for AUDCAD.
2025-06-03 00:40:41,424 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:42,283 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:42,283 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.40000000000000000000000000
2025-06-03 00:40:42,284 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0')}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:42,292 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:44,670 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:44,670 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.32000000000000000000000000
2025-06-03 00:40:44,670 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:44,674 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:46,912 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:46,913 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.32000000000000000000000000
2025-06-03 00:40:46,913 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:46,917 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:49,296 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:49,296 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866300000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.37000000000000000000000000
2025-06-03 00:40:49,296 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:49,310 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:51,633 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:51,633 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.30000000000000000000000000
2025-06-03 00:40:51,633 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:51,639 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:53,893 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:53,893 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.31000000000000000000000000
2025-06-03 00:40:53,894 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:53,900 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:56,211 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:56,211 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.30000000000000000000000000
2025-06-03 00:40:56,211 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:56,215 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:40:58,455 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:40:58,456 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.30000000000000000000000000
2025-06-03 00:40:58,456 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:40:58,462 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:00,840 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:00,840 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.31000000000000000000000000
2025-06-03 00:41:00,840 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:00,845 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:03,069 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:03,069 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867000000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.30000000000000000000000000
2025-06-03 00:41:03,069 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:03,071 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:05,311 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:05,311 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.29000000000000000000000000
2025-06-03 00:41:05,311 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:05,313 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:07,681 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:07,681 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.32000000000000000000000000
2025-06-03 00:41:07,681 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:07,683 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:09,895 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:09,895 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.32000000000000000000000000
2025-06-03 00:41:09,895 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:09,897 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:12,276 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:12,276 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.28000000000000000000000000
2025-06-03 00:41:12,276 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:12,278 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:14,620 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:14,620 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866600000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.34000000000000000000000000
2025-06-03 00:41:14,620 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:14,622 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:16,872 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:16,872 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866600000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.34000000000000000000000000
2025-06-03 00:41:16,872 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:16,874 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:19,191 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:19,191 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.32000000000000000000000000
2025-06-03 00:41:19,191 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:19,193 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:21,447 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:21,447 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.28000000000000000000000000
2025-06-03 00:41:21,447 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:21,449 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:23,704 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:23,704 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8866900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.31000000000000000000000000
2025-06-03 00:41:23,704 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:23,706 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:26,023 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:26,024 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867500000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.25000000000000000000000000
2025-06-03 00:41:26,024 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:26,025 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:28,299 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:28,299 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.29000000000000000000000000
2025-06-03 00:41:28,299 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:28,301 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:30,607 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:30,607 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.28000000000000000000000000
2025-06-03 00:41:30,607 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:30,610 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:32,930 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:32,930 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.29000000000000000000000000
2025-06-03 00:41:32,930 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:32,934 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:35,204 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:35,204 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867500000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.25000000000000000000000000
2025-06-03 00:41:35,204 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:35,207 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:37,518 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:37,519 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.28000000000000000000000000
2025-06-03 00:41:37,519 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:37,523 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:39,806 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:39,806 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867500000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.25000000000000000000000000
2025-06-03 00:41:39,806 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:39,810 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:42,107 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:42,107 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867400000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.26000000000000000000000000
2025-06-03 00:41:42,107 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:42,110 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:44,412 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:44,412 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867800000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.22000000000000000000000000
2025-06-03 00:41:44,412 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:44,414 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:46,718 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:46,719 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867500000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.25000000000000000000000000
2025-06-03 00:41:46,719 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:46,723 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:49,022 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:49,022 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8868100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.19000000000000000000000000
2025-06-03 00:41:49,022 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:49,024 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:51,327 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:51,327 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.21000000000000000000000000
2025-06-03 00:41:51,327 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:51,329 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:53,627 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:53,627 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867200000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.28000000000000000000000000
2025-06-03 00:41:53,627 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:53,631 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:55,914 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:55,914 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.21000000000000000000000000
2025-06-03 00:41:55,914 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:55,917 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:41:58,182 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:41:58,182 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.21000000000000000000000000
2025-06-03 00:41:58,182 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:41:58,187 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:42:00,540 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:42:00,540 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.21000000000000000000000000
2025-06-03 00:42:00,540 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:42:00,543 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:42:02,930 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:42:02,930 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8867900000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.21000000000000000000000000
2025-06-03 00:42:02,930 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:42:02,931 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:42:05,342 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:42:05,342 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8868100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.19000000000000000000000000
2025-06-03 00:42:05,342 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:42:05,345 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:42:07,536 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:42:07,536 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8868100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.19000000000000000000000000
2025-06-03 00:42:07,536 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:42:07,539 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:42:09,846 - DEBUG - orders - User 1: Calculating portfolio for 1 open positions.
2025-06-03 00:42:09,846 - DEBUG - orders - User 1, Pos 2274538506: BUY PnL calculation: (0.8868100000 - 0.89000000) * 0.01000000 * 100000.00000000 = -3.19000000000000000000000000
2025-06-03 00:42:09,846 - ERROR - orders - User 1, Pos 2274538506: Generic error processing position in portfolio: name 'redis_client' is not defined. Data: {'order_id': Decimal('2274538506'), 'order_company_name': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01000000'), 'order_price': Decimal('0.89000000'), 'margin': Decimal('8.90000000'), 'contract_value': Decimal('1000.00000000'), 'stop_loss': Decimal('0.88000000'), 'take_profit': Decimal('0.90000000'), 'profit_loss': Decimal('0.0'), 'commission_applied': 0.0}
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\portfolio_calculator.py", line 159, in calculate_user_portfolio
    pnl_native, profit_currency, user_id, position_id, "Position PnL", redis_client, user_data.get('group_name', 'UNKNOWN_GROUP')
                                                                       ^^^^^^^^^^^^
NameError: name 'redis_client' is not defined
2025-06-03 00:42:09,849 - DEBUG - orders - User 1: Final Portfolio - Balance: 100000.00000000, Total PnL (USD): 0.0, Equity: 100000.00000000, Overall Hedged Margin (USD): 8.90000000, Free Margin: 99991.10000000, Margin Level: 1123595.505617977528089887640
2025-06-03 00:42:13,911 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:42:36,867 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:42:57,603 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:43:16,293 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:55:11,821 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 00:55:34,428 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:00:52,534 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:11:09,314 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:11:46,237 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:14:13,423 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:15:15,095 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:19:12,630 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:19:35,433 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:21:14,263 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:22:04,496 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:25:05,881 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:25:44,363 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:31:05,951 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:32:03,946 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:32:35,636 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:33:48,596 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 01:33:48,596 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 01:33:48,597 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 01:33:48,597 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 01:33:48,599 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('8.90000000')}
2025-06-03 01:33:48,599 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 01:33:48,609 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 01:33:48,610 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 01:33:48,612 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 01:33:48,612 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 01:33:48,612 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 01:33:48,612 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 01:33:48,636 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 01:33:48,637 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 01:33:48,639 - ERROR - orders - Unexpected error during margin calculation for user 1, symbol AUDCAD, order_type BUY: object dict can't be used in 'await' expression
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\margin_calculator.py", line 210, in calculate_single_order_margin
    raw_market_data = await get_latest_market_data()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-06-03 01:33:48,642 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 01:33:48,643 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 01:33:48,654 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 01:37:07,906 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:37:21,444 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:37:27,847 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 01:37:27,848 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 01:37:27,848 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 01:37:27,849 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 01:37:27,851 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('8.90000000')}
2025-06-03 01:37:27,852 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 01:37:27,870 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 01:37:27,871 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 01:37:27,873 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 01:37:27,873 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 01:37:27,874 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 01:37:27,874 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 01:37:27,923 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 01:37:27,923 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 01:37:27,924 - ERROR - orders - Unexpected error during margin calculation for user 1, symbol AUDCAD, order_type BUY: object dict can't be used in 'await' expression
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\margin_calculator.py", line 210, in calculate_single_order_margin
    raw_market_data = await get_latest_market_data()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-06-03 01:37:27,932 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 01:37:27,933 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 01:37:27,943 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 199, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 01:45:02,585 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 01:46:40,801 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 01:46:40,801 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 01:46:40,801 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 01:46:40,802 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 01:46:40,803 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('8.90000000')}
2025-06-03 01:46:40,803 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 01:46:40,812 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 01:46:40,812 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 01:46:40,814 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 01:46:40,814 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 01:46:40,814 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 01:46:40,814 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 01:46:40,824 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 01:46:40,825 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 01:46:40,825 - ERROR - orders - Unexpected error during margin calculation for user 1, symbol AUDCAD, order_type BUY: object dict can't be used in 'await' expression
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\margin_calculator.py", line 210, in calculate_single_order_margin
    raw_market_data = await get_latest_market_data()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-06-03 01:46:40,826 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 01:46:40,826 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 01:46:40,827 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 190, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 02:10:11,537 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 02:10:11,537 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 02:10:11,537 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 02:10:11,537 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 02:10:11,538 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('8.90000000')}
2025-06-03 02:10:11,539 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 02:10:11,546 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 02:10:11,546 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 02:10:11,548 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 02:10:11,548 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 02:10:11,548 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 02:10:11,548 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 02:10:11,554 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 02:10:11,555 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 02:10:11,555 - ERROR - orders - Unexpected error during margin calculation for user 1, symbol AUDCAD, order_type BUY: object dict can't be used in 'await' expression
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\margin_calculator.py", line 210, in calculate_single_order_margin
    raw_market_data = await get_latest_market_data()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-06-03 02:10:11,556 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 02:10:11,556 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 02:10:11,557 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 190, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 02:12:10,651 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:13:43,021 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:17:45,091 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:18:17,052 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:18:35,377 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:19:44,914 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 02:19:44,915 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 02:19:44,915 - INFO - orders - Processing new order for user 1, symbol AUDCAD, type BUY, quantity 0.01
2025-06-03 02:19:44,915 - INFO - orders - Starting margin calculation for user 1, symbol AUDCAD, order_type BUY
2025-06-03 02:19:44,917 - INFO - orders - User data from cache: {'id': 1, 'group_name': 'Group B', 'leverage': Decimal('100.00'), 'wallet_balance': Decimal('100000.00000000'), 'margin': Decimal('8.90000000')}
2025-06-03 02:19:44,917 - INFO - orders - Found user data in cache - leverage: 100.00, group: Group B
2025-06-03 02:19:44,926 - INFO - orders - Symbol type for AUDCAD: 1
2025-06-03 02:19:44,926 - INFO - orders - Fetching group settings for group 'Group B', symbol 'AUDCAD'
2025-06-03 02:19:44,927 - INFO - orders - Group settings from cache: {'commision_type': 1, 'commision_value_type': 0, 'type': 1, 'pip_currency': 'USD', 'show_points': 5, 'swap_buy': Decimal('-6.5528'), 'swap_sell': Decimal('-1.1040'), 'commision': Decimal('10.0000'), 'margin': Decimal('1.0000'), 'spread': Decimal('0.0000'), 'deviation': Decimal('0.4000'), 'min_lot': Decimal('0.0100'), 'max_lot': Decimal('10.0000'), 'pips': Decimal('10.0000'), 'spread_pip': Decimal('0.0001'), 'contract_size': Decimal('100000.00000000'), 'profit_currency': 'CAD'}
2025-06-03 02:19:44,927 - INFO - orders - Raw values from cache - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 02:19:44,927 - INFO - orders - Parsed values - spread: 0.0000, spread_pip: 0.0001, margin: 1.0000
2025-06-03 02:19:44,927 - INFO - orders - Fetching ExternalSymbolInfo for symbol AUDCAD
2025-06-03 02:19:44,937 - INFO - orders - ExternalSymbolInfo found: <ExternalSymbolInfo(fix_symbol='AUDCAD', instrument_type='1', contract_size=100000.00000000)>
2025-06-03 02:19:44,938 - INFO - orders - Symbol info - contract_size: 100000.00000000, profit_currency: CAD, digits: 5.00000
2025-06-03 02:19:44,938 - ERROR - orders - Unexpected error during margin calculation for user 1, symbol AUDCAD, order_type BUY: object dict can't be used in 'await' expression
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\margin_calculator.py", line 210, in calculate_single_order_margin
    raw_market_data = await get_latest_market_data()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-06-03 02:19:44,939 - ERROR - orders - Margin calculation returned None values for user 1, symbol AUDCAD
2025-06-03 02:19:44,939 - ERROR - orders - Error in process_new_order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values
2025-06-03 02:19:44,941 - ERROR - orders - Error processing order for user 1: Failed to process order: Margin calculation returned invalid values
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 121, in process_new_order
    raise OrderProcessingError("Margin calculation returned invalid values")
app.services.order_processing.OrderProcessingError: Margin calculation returned invalid values

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 190, in process_new_order
    raise OrderProcessingError(f"Failed to process order: {str(e)}")
app.services.order_processing.OrderProcessingError: Failed to process order: Margin calculation returned invalid values
2025-06-03 02:21:19,829 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:21:41,870 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:22:00,366 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:22:27,811 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:22:37,428 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 02:22:37,428 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 02:22:37,428 - ERROR - orders - Error processing order for user 1: process_new_order() got an unexpected keyword argument 'user'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                      ~~~~~~~~~~~~~~~~~^
        db=db,
        ^^^^^^
    ...<5 lines>...
        get_user_by_id_with_lock_fn=get_user_by_id_with_lock_fn
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: process_new_order() got an unexpected keyword argument 'user'
2025-06-03 02:23:33,001 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:23:55,785 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:24:02,804 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:24:31,523 - INFO - orders - Received order request from user 1: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'ACTIVE', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 02:24:31,523 - DEBUG - orders - Processing order for user 1 with type demo
2025-06-03 02:24:31,523 - ERROR - orders - Error processing order for user 1: process_new_order() got an unexpected keyword argument 'user'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    new_order = await process_new_order(
                      ~~~~~~~~~~~~~~~~~^
        db=db,
        ^^^^^^
    ...<5 lines>...
        get_user_by_id_with_lock_fn=get_user_by_id_with_lock_fn
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: process_new_order() got an unexpected keyword argument 'user'
2025-06-03 02:38:54,655 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:39:08,925 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:39:08,925 - ERROR - orders - Error processing new order: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 99, in process_new_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined
2025-06-03 02:39:08,933 - ERROR - orders - Order processing error: name 'get_user_data_cache' is not defined
2025-06-03 02:41:08,886 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:42:11,837 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:42:11,837 - ERROR - orders - Error processing new order: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 99, in process_new_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined
2025-06-03 02:42:11,843 - ERROR - orders - Order processing error: name 'get_user_data_cache' is not defined
2025-06-03 02:42:40,294 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:42:40,294 - ERROR - orders - Error processing new order: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 99, in process_new_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined
2025-06-03 02:42:40,303 - ERROR - orders - Order processing error: name 'get_user_data_cache' is not defined
2025-06-03 02:43:47,012 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:44:03,033 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:44:06,066 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:44:06,067 - ERROR - orders - Error processing new order: name 'get_latest_market_data' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 105, in process_new_order
    raw_market_data = await get_latest_market_data()
                            ^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_latest_market_data' is not defined
2025-06-03 02:44:06,069 - ERROR - orders - Order processing error: name 'get_latest_market_data' is not defined
2025-06-03 02:48:07,424 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:48:57,443 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:48:57,773 - ERROR - orders - Error processing new order: name 'get_group_symbol_settings_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 113, in process_new_order
    group_settings = await get_group_symbol_settings_cache(redis_client, group_name, symbol)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_group_symbol_settings_cache' is not defined
2025-06-03 02:48:57,785 - ERROR - orders - Order processing error: name 'get_group_symbol_settings_cache' is not defined
2025-06-03 02:49:27,201 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:50:30,804 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:50:31,172 - ERROR - orders - Error processing new order: name 'set_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 158, in process_new_order
    await set_user_data_cache(redis_client, user_id, {
          ^^^^^^^^^^^^^^^^^^^
NameError: name 'set_user_data_cache' is not defined. Did you mean: 'get_user_data_cache'?
2025-06-03 02:50:31,175 - ERROR - orders - Order processing error: name 'set_user_data_cache' is not defined
2025-06-03 02:50:43,079 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:50:51,416 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:50:51,752 - ERROR - orders - Unexpected error in place_order: module 'app.crud.crud_order' has no attribute 'create_user_order'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 145, in place_order
    db_order = await crud_order.create_user_order(db, new_order, order_model)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'app.crud.crud_order' has no attribute 'create_user_order'. Did you mean: 'create_order'?
2025-06-03 02:52:26,440 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 02:52:33,864 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 02:59:14,424 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:03:46,864 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:04:06,775 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:04:07,085 - ERROR - orders - Error processing new order: calculate_single_order_margin() missing 1 required positional argument: 'redis_client'
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 123, in process_new_order
    margin_usd, adjusted_price, contract_value = await calculate_single_order_margin(
                                                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        symbol=symbol,
        ^^^^^^^^^^^^^^
    ...<5 lines>...
        raw_market_data=raw_market_data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
TypeError: calculate_single_order_margin() missing 1 required positional argument: 'redis_client'
2025-06-03 03:04:07,086 - ERROR - orders - Order processing error: calculate_single_order_margin() missing 1 required positional argument: 'redis_client'
2025-06-03 03:05:11,620 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:05:24,721 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:11:44,954 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:11:53,540 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:12:00,463 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:13:46,101 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:15:51,649 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:19:05,142 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:19:05,851 - ERROR - orders - Error processing new order: No group settings found for 
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 115, in process_new_order
    raise OrderProcessingError(f"No group settings found for {symbol}")
app.services.order_processing.OrderProcessingError: No group settings found for 
2025-06-03 03:19:05,852 - ERROR - orders - Order processing error: No group settings found for 
2025-06-03 03:19:23,046 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:19:23,336 - ERROR - orders - Error processing new order: No group settings found for 
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 115, in process_new_order
    raise OrderProcessingError(f"No group settings found for {symbol}")
app.services.order_processing.OrderProcessingError: No group settings found for 
2025-06-03 03:19:23,337 - ERROR - orders - Order processing error: No group settings found for 
2025-06-03 03:19:34,319 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:19:34,617 - ERROR - orders - Error processing new order: No group settings found for 
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 115, in process_new_order
    raise OrderProcessingError(f"No group settings found for {symbol}")
app.services.order_processing.OrderProcessingError: No group settings found for 
2025-06-03 03:19:34,617 - ERROR - orders - Order processing error: No group settings found for 
2025-06-03 03:23:36,798 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:24:21,657 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:24:21,962 - ERROR - orders - Error processing new order: No group settings found for 
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 138, in process_new_order
    raise OrderProcessingError(f"No group settings found for {symbol}")
app.services.order_processing.OrderProcessingError: No group settings found for 
2025-06-03 03:24:21,963 - ERROR - orders - Order processing error: No group settings found for 
2025-06-03 03:27:54,318 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:28:31,399 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:28:31,714 - ERROR - orders - Error processing new order: No group settings found for 
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 138, in process_new_order
    raise OrderProcessingError(f"No group settings found for {symbol}")
app.services.order_processing.OrderProcessingError: No group settings found for 
2025-06-03 03:28:31,718 - ERROR - orders - Order processing error: No group settings found for 
2025-06-03 03:31:06,550 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCHF, Type: BUY, Quantity: 0.01
2025-06-03 03:31:06,909 - ERROR - orders - Error processing new order: No group settings found for 
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 138, in process_new_order
    raise OrderProcessingError(f"No group settings found for {symbol}")
app.services.order_processing.OrderProcessingError: No group settings found for 
2025-06-03 03:31:06,910 - ERROR - orders - Order processing error: No group settings found for 
2025-06-03 03:31:18,396 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDJPY, Type: BUY, Quantity: 0.01
2025-06-03 03:31:18,704 - ERROR - orders - Error processing new order: No group settings found for 
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 138, in process_new_order
    raise OrderProcessingError(f"No group settings found for {symbol}")
app.services.order_processing.OrderProcessingError: No group settings found for 
2025-06-03 03:31:18,706 - ERROR - orders - Order processing error: No group settings found for 
2025-06-03 03:31:50,094 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:32:19,500 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDJPY, Type: BUY, Quantity: 0.01
2025-06-03 03:32:19,817 - ERROR - orders - Order processing failed: order_company_name is missing or blank in order_data: {'symbol': 'AUDJPY', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'OPEN', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 03:32:19,817 - ERROR - orders - Error processing new order: Symbol is required for order processing
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 114, in process_new_order
    raise OrderProcessingError("Symbol is required for order processing")
app.services.order_processing.OrderProcessingError: Symbol is required for order processing
2025-06-03 03:32:19,819 - ERROR - orders - Order processing error: Symbol is required for order processing
2025-06-03 03:32:30,542 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:32:30,867 - ERROR - orders - Order processing failed: order_company_name is missing or blank in order_data: {'symbol': 'AUDCAD', 'order_type': 'BUY', 'order_quantity': Decimal('0.01'), 'order_price': Decimal('0.89'), 'user_type': 'live', 'user_id': 1, 'order_status': 'OPEN', 'status': 'OPEN', 'stop_loss': Decimal('0.88'), 'take_profit': Decimal('0.9'), 'contract_value': None, 'margin': None, 'close_price': None, 'net_profit': None, 'swap': None, 'commission': None, 'cancel_message': None, 'close_message': None, 'cancel_id': None, 'close_id': None, 'modify_id': None, 'stoploss_id': None, 'takeprofit_id': None, 'stoploss_cancel_id': None, 'takeprofit_cancel_id': None}
2025-06-03 03:32:30,874 - ERROR - orders - Error processing new order: Symbol is required for order processing
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 114, in process_new_order
    raise OrderProcessingError("Symbol is required for order processing")
app.services.order_processing.OrderProcessingError: Symbol is required for order processing
2025-06-03 03:32:30,903 - ERROR - orders - Order processing error: Symbol is required for order processing
2025-06-03 03:33:12,619 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:35:37,638 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:35:44,266 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:35:58,290 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:35:58,290 - ERROR - orders - Unexpected error in place_order: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 134, in place_order
    user_data = await get_user_data_cache(redis_client, order_request.user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 03:36:51,033 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:37:04,580 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:37:04,580 - ERROR - orders - Unexpected error in place_order: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 134, in place_order
    user_data = await get_user_data_cache(redis_client, order_request.user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 03:37:42,375 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:37:42,377 - ERROR - orders - Unexpected error in place_order: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 134, in place_order
    user_data = await get_user_data_cache(redis_client, order_request.user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 03:38:10,501 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:38:38,307 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:38:38,338 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 169, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:40:22,519 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:40:30,194 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:40:37,208 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:42:03,144 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:42:12,146 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:42:12,168 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 120, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:42:38,562 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:42:50,740 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:42:50,760 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:43:29,076 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:44:05,215 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:44:05,240 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:45:07,533 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:45:11,923 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:45:11,948 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:46:44,815 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:46:58,917 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:46:58,935 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:47:17,285 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:47:40,794 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:47:40,808 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:49:43,498 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:49:49,118 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:49:49,131 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:52:17,306 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:52:22,424 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:52:22,455 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:53:23,948 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:53:38,951 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:53:38,972 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:54:42,437 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:55:20,194 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:55:24,907 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:55:24,947 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:57:08,818 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:57:20,308 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:57:34,048 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:57:34,060 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 03:58:28,136 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:58:32,223 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 03:58:37,826 - INFO - orders - Order placement request received - User ID: 1, Order Company Name: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 03:58:37,845 - ERROR - orders - Unexpected error in place_order: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 119, in place_order
    cached_adj_price = await get_adjusted_market_price_cache(redis_client, group_name, sym_upper)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 04:04:00,565 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:04:14,561 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:10:19,681 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:11:56,346 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:11:57,004 - ERROR - orders - Error processing new order: Insufficient margin
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 140, in process_new_order
    raise OrderProcessingError("Insufficient margin")
app.services.order_processing.OrderProcessingError: Insufficient margin
2025-06-03 04:11:57,005 - ERROR - orders - Order processing error: Insufficient margin
2025-06-03 04:15:05,060 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:15:52,932 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:18:06,537 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:23:26,825 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:23:27,546 - ERROR - orders - Error processing new order: Insufficient margin
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 140, in process_new_order
    raise OrderProcessingError("Insufficient margin")
app.services.order_processing.OrderProcessingError: Insufficient margin
2025-06-03 04:23:27,546 - ERROR - orders - Order processing error: Insufficient margin
2025-06-03 04:23:39,763 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:23:40,059 - ERROR - orders - Error processing new order: Insufficient margin
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 140, in process_new_order
    raise OrderProcessingError("Insufficient margin")
app.services.order_processing.OrderProcessingError: Insufficient margin
2025-06-03 04:23:40,060 - ERROR - orders - Order processing error: Insufficient margin
2025-06-03 04:23:52,898 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:23:53,206 - ERROR - orders - Error processing new order: Insufficient margin
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 140, in process_new_order
    raise OrderProcessingError("Insufficient margin")
app.services.order_processing.OrderProcessingError: Insufficient margin
2025-06-03 04:23:53,207 - ERROR - orders - Order processing error: Insufficient margin
2025-06-03 04:25:23,612 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:27:19,711 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:27:20,351 - ERROR - orders - Error processing new order: Insufficient margin
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 140, in process_new_order
    raise OrderProcessingError("Insufficient margin")
app.services.order_processing.OrderProcessingError: Insufficient margin
2025-06-03 04:27:20,353 - ERROR - orders - Order processing error: Insufficient margin
2025-06-03 04:29:01,803 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:30:33,845 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:32:44,849 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:34:14,904 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:35:47,271 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:38:58,706 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:38:59,328 - ERROR - orders - Error processing new order: Insufficient margin
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\services\order_processing.py", line 140, in process_new_order
    raise OrderProcessingError("Insufficient margin")
app.services.order_processing.OrderProcessingError: Insufficient margin
2025-06-03 04:38:59,332 - ERROR - orders - Order processing error: Insufficient margin
2025-06-03 04:41:02,612 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:41:34,090 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 0.01
2025-06-03 04:42:39,016 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 04:42:48,178 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 04:47:47,115 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:51:40,996 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:52:22,286 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 04:54:33,706 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:00:46,258 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:02:23,154 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:05:03,678 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:18:51,176 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:23:57,722 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:24:12,078 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:24:12,487 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 153, in place_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 05:35:20,609 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:36:47,388 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:36:48,216 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 153, in place_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 05:40:09,015 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:50:06,078 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:53:04,224 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:53:22,288 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:54:14,068 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:54:14,363 - ERROR - orders - Order processing error: Failed to process order: name 'get_order_model' is not defined
2025-06-03 05:54:52,457 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:55:10,789 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:55:11,213 - ERROR - orders - Order processing error: Failed to process order: module 'app.crud.crud_order' has no attribute 'get_open_orders_by_user_id_and_symbol'
2025-06-03 05:55:50,186 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:56:04,655 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 05:56:05,014 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 153, in place_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 05:59:24,614 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 05:59:49,813 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 06:00:31,757 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 06:00:32,268 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '69893717-a874-43e3-bab1-ce153b49f719' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('69893717-a874-43e3-bab1-ce153b49f719', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8857400000', '1', '88574.000000000000000000', '652.3772067820311134417059955', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '69893717-a874-43e3-bab1-ce153b49f719' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 145, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '69893717-a874-43e3-bab1-ce153b49f719' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('69893717-a874-43e3-bab1-ce153b49f719', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8857400000', '1', '88574.000000000000000000', '652.3772067820311134417059955', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 07:40:41,116 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 07:51:34,874 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 07:51:35,884 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '20397ddd-86f6-4b03-a69e-a0e76bdef254' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('20397ddd-86f6-4b03-a69e-a0e76bdef254', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8864000000', '1', '88640.000000000000000000', '653.8245527020225964799673234', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '20397ddd-86f6-4b03-a69e-a0e76bdef254' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 145, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '20397ddd-86f6-4b03-a69e-a0e76bdef254' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('20397ddd-86f6-4b03-a69e-a0e76bdef254', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8864000000', '1', '88640.000000000000000000', '653.8245527020225964799673234', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 07:52:13,341 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 07:52:29,218 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 07:52:29,671 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '04b9bcf9-7423-43a6-b0d5-9e0204367ff9' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('04b9bcf9-7423-43a6-b0d5-9e0204367ff9', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8865600000', '1', '88656.000000000000000000', '653.9889562407451984448286175', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '04b9bcf9-7423-43a6-b0d5-9e0204367ff9' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 145, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '04b9bcf9-7423-43a6-b0d5-9e0204367ff9' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('04b9bcf9-7423-43a6-b0d5-9e0204367ff9', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8865600000', '1', '88656.000000000000000000', '653.9889562407451984448286175', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, None, None, None, None, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 07:57:05,411 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 07:58:00,943 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 07:58:01,389 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '6544932240' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('6544932240', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8864300000', '1', '88643.000000000000000000', '654.1422514758572377206488664', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '7497541545', '1344749400', None, '6606570968', '6213308870', '6420856648', '2886046506')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '6544932240' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 145, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '6544932240' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('6544932240', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8864300000', '1', '88643.000000000000000000', '654.1422514758572377206488664', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '7497541545', '1344749400', None, '6606570968', '6213308870', '6420856648', '2886046506')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 08:00:46,836 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:00:53,451 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:00:53,865 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '6306636063' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('6306636063', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8865600000', '1', '88656.000000000000000000', '654.1846041590660342940532652', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '7169181950', '8981150872', None, '2879824007', '6070090479', '2218366526', '3170722181')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '6306636063' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 144, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '6306636063' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('6306636063', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8865600000', '1', '88656.000000000000000000', '654.1846041590660342940532652', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '7169181950', '8981150872', None, '2879824007', '6070090479', '2218366526', '3170722181')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 08:03:40,441 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:03:41,545 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '5167742242' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('5167742242', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8866000000', '1', '88660.000000000000000000', '654.0419882409582305997694878', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '4703816488', '2019803258', None, '7812214892', '7872211289', '3319738771', '7133438765')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '5167742242' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 144, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '5167742242' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('5167742242', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8866000000', '1', '88660.000000000000000000', '654.0419882409582305997694878', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '4703816488', '2019803258', None, '7812214892', '7872211289', '3319738771', '7133438765')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 08:03:43,393 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:03:44,048 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '4957011076' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('4957011076', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8867100000', '1', '88671.000000000000000000', '654.1222298411216316764658681', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '9636355165', '6404408281', None, '3734035182', '7166748359', '5274147257', '2837576588')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '4957011076' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 144, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '4957011076' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('4957011076', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8867100000', '1', '88671.000000000000000000', '654.1222298411216316764658681', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '9636355165', '6404408281', None, '3734035182', '7166748359', '5274147257', '2837576588')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 08:03:45,965 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:03:46,691 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '9938724726' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('9938724726', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8867400000', '1', '88674.000000000000000000', '654.1632015873710625756846267', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '3275719326', '5539972601', None, '5545776173', '6790739250', '1738962496', '4246087405')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '9938724726' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 144, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '9938724726' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('9938724726', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8867400000', '1', '88674.000000000000000000', '654.1632015873710625756846267', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '3275719326', '5539972601', None, '5545776173', '6790739250', '1738962496', '4246087405')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 08:05:13,857 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:05:21,045 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:05:52,298 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:10:50,459 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:10:55,799 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:10:56,371 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '8038870577' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('8038870577', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8865500000', '1', '88655.000000000000000000', '653.6383718641324555455917412', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '5711983338', '4092511674', None, '5508900573', '5209831068', '4861756836', '3210755343')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '8038870577' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 144, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '8038870577' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('8038870577', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8865500000', '1', '88655.000000000000000000', '653.6383718641324555455917412', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '5711983338', '4092511674', None, '5508900573', '5209831068', '4861756836', '3210755343')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 08:17:08,160 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:18:51,988 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:22:38,317 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:23:07,850 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:23:08,989 - ERROR - orders - Unexpected error in place_order: (pymysql.err.IntegrityError) (1062, "Duplicate entry '4315349946' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('4315349946', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8863700000', '1', '88637.000000000000000000', '653.3070952224773149666557341', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '8426339281', '8760326880', None, '3663642978', '8148094201', '1748163218', '8033610687')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.IntegrityError: (1062, "Duplicate entry '4315349946' for key 'demo_user_orders.ix_demo_user_orders_order_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 144, in place_order
    db_order = await crud_order.create_order(db, new_order, order_model)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\app\crud\crud_order.py", line 21, in create_order
    await db.commit()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1014, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2032, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1313, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1288, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 97, in execute
    return self.await_(self._execute_async(operation, parameters))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\sqlalchemy\dialects\mysql\aiomysql.py", line 106, in _execute_async
    result = await self._cursor.execute(operation, parameters)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 239, in execute
    await self._query(query)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\cursors.py", line 457, in _query
    await conn.query(q)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 469, in query
    await self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 683, in _read_query_result
    await result.read()
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 1164, in read
    first_packet = await self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\aiomysql\connection.py", line 652, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Dhanush\FASTAPI\venv\Lib\site-packages\pymysql\err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '4315349946' for key 'demo_user_orders.ix_demo_user_orders_order_id'")
[SQL: INSERT INTO demo_user_orders (order_id, order_user_id, order_company_name, order_type, order_status, order_price, order_quantity, contract_value, margin, stop_loss, take_profit, close_price, net_profit, swap, commission, cancel_message, close_message, cancel_id, close_id, modify_id, stoploss_id, takeprofit_id, stoploss_cancel_id, takeprofit_cancel_id) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ('4315349946', 1, 'AUDCAD', 'BUY', 'OPEN', '0.8863700000', '1', '88637.000000000000000000', '653.3070952224773149666557341', Decimal('0.88'), Decimal('0.9'), None, None, None, '10.00', None, None, '8426339281', '8760326880', None, '3663642978', '8148094201', '1748163218', '8033610687')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-03 08:27:27,422 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:27:35,923 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 08:58:27,614 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:58:28,251 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 152, in place_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 08:59:02,757 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 08:59:03,157 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 152, in place_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 09:04:01,535 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 09:04:20,045 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 09:04:20,444 - ERROR - orders - Unexpected error in place_order: name 'get_user_data_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 151, in place_order
    user_data = await get_user_data_cache(redis_client, user_id)
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'get_user_data_cache' is not defined. Did you mean: 'set_user_data_cache'?
2025-06-03 09:08:42,654 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 09:11:00,038 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 09:13:00,953 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 09:13:10,279 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 09:13:16,805 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 09:13:17,254 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 190, in place_order
    prices = await get_adjusted_market_price_cache(redis_client, group_name, symbol)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 09:17:56,603 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 09:18:07,525 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 09:18:07,910 - INFO - orders - [MARGIN DEBUG] user_id=1, group_name=Group B, sending_orders=None, user_type=live
2025-06-03 09:18:07,918 - INFO - orders - [MARGIN DEBUG] open_positions count: 1
2025-06-03 09:18:07,918 - INFO - orders - [MARGIN DEBUG] symbols found: {'AUDCAD'}
2025-06-03 09:18:07,919 - INFO - orders - [MARGIN DEBUG] Calculating margin for symbol: AUDCAD with 1 positions
2025-06-03 09:18:07,930 - INFO - orders - [MARGIN DEBUG] Margin for symbol AUDCAD: 0.0
2025-06-03 09:18:07,930 - INFO - orders - [MARGIN DEBUG] Total margin to update for user 1: 0.0
2025-06-03 09:18:07,953 - INFO - orders - [MARGIN DEBUG] Margin updated in DB for user 1
2025-06-03 09:18:07,978 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 198, in place_order
    prices = await get_adjusted_market_price_cache(redis_client, group_name, symbol)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 10:35:07,982 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 10:35:08,590 - INFO - orders - [MARGIN DEBUG] user_id=1, group_name=Group B, sending_orders=None, user_type=demo
2025-06-03 10:35:08,595 - INFO - orders - [MARGIN DEBUG] open_positions count: 1
2025-06-03 10:35:08,595 - INFO - orders - [MARGIN DEBUG] symbols found: {'AUDCAD'}
2025-06-03 10:35:08,595 - INFO - orders - [MARGIN DEBUG] Calculating margin for symbol: AUDCAD with 1 positions
2025-06-03 10:35:08,602 - INFO - orders - [MARGIN DEBUG] Margin for symbol AUDCAD: 0.0
2025-06-03 10:35:08,602 - INFO - orders - [MARGIN DEBUG] Total margin to update for user 1: 0.0
2025-06-03 10:35:08,618 - INFO - orders - [MARGIN DEBUG] Margin updated in DB for user 1
2025-06-03 10:35:08,633 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 198, in place_order
    prices = await get_adjusted_market_price_cache(redis_client, group_name, symbol)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 12:12:33,674 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 12:13:37,747 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 12:14:21,288 - INFO - orders - Application starting up - Orders logging initialized
2025-06-03 12:15:51,063 - INFO - orders - Order placement request received - User ID: 1, Symbol: AUDCAD, Type: BUY, Quantity: 1
2025-06-03 12:15:51,065 - INFO - orders - Order placement: user_id=1, is_barclays_live_user=False, user_type=demo, sending_orders_setting=None
2025-06-03 12:15:52,245 - INFO - orders - [MARGIN DEBUG] user_id=1, group_name=Group B, sending_orders=None, user_type=demo, is_barclays_live_user_flag_check=False
2025-06-03 12:15:52,255 - INFO - orders - [MARGIN DEBUG] open_positions count: 2
2025-06-03 12:15:52,255 - INFO - orders - [MARGIN DEBUG] symbols found: {'AUDCAD'}
2025-06-03 12:15:52,255 - INFO - orders - [MARGIN DEBUG] Calculating margin for symbol: AUDCAD with 2 positions
2025-06-03 12:15:52,265 - INFO - orders - [MARGIN DEBUG] Margin for symbol AUDCAD: 0.0
2025-06-03 12:15:52,265 - INFO - orders - [MARGIN DEBUG] Total margin to update for user 1: 0.0
2025-06-03 12:15:52,283 - INFO - orders - [MARGIN DEBUG] Margin updated in DB for user 1
2025-06-03 12:15:52,303 - ERROR - orders - Error updating portfolio cache or publishing websocket event after order placement: name 'get_adjusted_market_price_cache' is not defined
Traceback (most recent call last):
  File "C:\Users\Dhanush\FASTAPI\app\api\v1\endpoints\orders.py", line 208, in place_order
    prices = await get_adjusted_market_price_cache(redis_client, group_name, symbol)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
NameError: name 'get_adjusted_market_price_cache' is not defined
2025-06-03 12:27:15,122 - INFO - orders - Application starting up - Orders logging initialized
